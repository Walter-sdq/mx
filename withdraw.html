<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Withdraw Funds - Top-Margin  Trading</title>
    <meta name="description" content="Withdraw funds from your Top-Margin  trading account">
    
    <link rel="icon" type="image/svg+xml" href="img/logo.svg">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<style>
    /* Ensure proper scaling */
html, body {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  width: 100%;
  overflow-x: hidden; /* Prevent horizontal scroll */
}

*, *::before, *::after {
  box-sizing: inherit;
}

/* Dashboard container - make responsive */
.dashboard-container {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  max-width: 100%;
  padding: 1rem;
  overflow-x: hidden;
}

/* Topbar responsiveness */
.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
  padding: 0.75rem 1rem;
  background: var(--color-bg-secondary, #222);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.topbar-left {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex: 1;
}

.page-title {
  font-size: clamp(1.2rem, 3vw, 1.8rem);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Withdraw container adjustments */
.withdraw-container {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  width: 100%;
  max-width: 700px;
  margin: 0 auto;
  padding: 1rem;
}

/* Responsive method list */
.methods-list {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
}

.method-item {
  flex: 1 1 200px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  background: var(--color-bg-card, #333);
  border-radius: 12px;
  cursor: pointer;
  transition: background 0.2s ease;
}

.method-item:hover {
  background: var(--color-bg-hover, #444);
}

/* Form responsiveness */
.withdraw-form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.amount-input-group {
  display: flex;
  align-items: center;
  background: var(--color-bg-card, #333);
  padding: 0.5rem;
  border-radius: 8px;
}

.amount-input-group input {
  flex: 1;
  border: none;
  background: transparent;
  color: inherit;
  font-size: 1.1rem;
  padding: 0.5rem;
}

.quick-amounts {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.quick-amount-btn {
  flex: 1 1 calc(50% - 0.5rem);
  padding: 0.75rem;
  border-radius: 8px;
  background: var(--color-bg-card, #333);
  border: 1px solid rgba(255, 255, 255, 0.1);
  cursor: pointer;
  text-align: center;
  transition: background 0.2s ease;
}

.quick-amount-btn:hover {
  background: var(--color-bg-hover, #444);
}

.fee-summary {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  padding: 1rem;
  border-radius: 10px;
  background: var(--color-bg-card, #333);
}

.fee-item {
  display: flex;
  justify-content: space-between;
}

/* Ensure button is full-width on mobile */
#withdraw-submit {
  width: 100%;
}

/* Enhanced Responsive Design */
@media (max-width: 1024px) {
  .withdraw-container {
    max-width: 100%;
    padding: 1rem;
  }

  .methods-list {
    gap: 0.75rem;
  }

  .method-item {
    flex: 1 1 calc(50% - 0.5rem);
    min-width: 280px;
  }

  .quick-amount-btn {
    flex: 1 1 calc(50% - 0.25rem);
  }
}

@media (max-width: 768px) {
  .dashboard-container {
    padding: 0.75rem;
  }

  .topbar {
    padding: 0.5rem 0.75rem;
    gap: 0.75rem;
  }

  .topbar-left {
    flex: 1;
    min-width: 0;
  }

  .page-title {
    font-size: 1.25rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .withdraw-container {
    padding: 0.75rem;
    gap: 1.25rem;
  }

  .balance-card {
    padding: 1rem;
  }

  .balance-amount {
    font-size: 1.75rem;
  }

  .methods-list {
    flex-direction: column;
    gap: 0.75rem;
  }

  .method-item {
    flex: 1 1 100%;
    min-width: unset;
    padding: 0.875rem;
  }

  .method-info h4 {
    font-size: 1rem;
  }

  .method-info p {
    font-size: 0.875rem;
  }

  .withdraw-form {
    gap: 0.875rem;
  }

  .amount-input-group {
    padding: 0.75rem;
  }

  .amount-input-group input {
    font-size: 1rem;
    padding: 0.5rem;
  }

  .quick-amounts {
    gap: 0.5rem;
  }

  .quick-amount-btn {
    flex: 1 1 calc(50% - 0.25rem);
    padding: 0.625rem;
    font-size: 0.875rem;
  }

  .fee-summary {
    padding: 0.875rem;
  }

  .fee-item {
    font-size: 0.875rem;
  }

  .withdrawal-details {
    padding: 0.75rem;
  }

  .account-display {
    flex-direction: column;
    gap: 0.5rem;
    align-items: flex-start;
  }

  .account-display .change-btn {
    align-self: flex-start;
  }

  #withdraw-submit {
    padding: 0.875rem;
    font-size: 1rem;
  }
}

@media (max-width: 480px) {
  .dashboard-container {
    padding: 0.5rem;
  }

  .topbar {
    padding: 0.5rem;
    gap: 0.5rem;
  }

  .topbar-left {
    gap: 0.5rem;
  }

  .back-btn {
    padding: 0.5rem;
    width: 36px;
    height: 36px;
  }

  .page-title {
    font-size: 1.125rem;
  }

  .withdraw-container {
    padding: 0.5rem;
    gap: 1rem;
  }

  .balance-card {
    padding: 0.875rem;
  }

  .balance-amount {
    font-size: 1.5rem;
  }

  .balance-note {
    font-size: 0.75rem;
  }

  .balance-note span {
    display: block;
    margin-top: 0.25rem;
  }

  .method-item {
    padding: 0.75rem;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.75rem;
  }

  .method-info {
    flex: 1;
  }

  .method-status {
    align-self: flex-end;
  }

  .amount-input-group {
    padding: 0.625rem;
  }

  .amount-input-group input {
    font-size: 0.9375rem;
    padding: 0.375rem;
  }

  .quick-amounts {
    gap: 0.375rem;
  }

  .quick-amount-btn {
    flex: 1 1 100%;
    padding: 0.5rem;
    font-size: 0.8125rem;
  }

  .fee-summary {
    padding: 0.75rem;
  }

  .fee-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.25rem;
    font-size: 0.8125rem;
  }

  .fee-item.total {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 0.5rem;
    margin-top: 0.5rem;
  }

  .withdrawal-details {
    padding: 0.625rem;
  }

  .form-group {
    margin-bottom: 0.75rem;
  }

  .form-group label {
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
  }

  .account-display {
    gap: 0.375rem;
  }

  .account-info {
    gap: 0.25rem;
  }

  .account-name {
    font-size: 0.875rem;
  }

  .account-number {
    font-size: 0.75rem;
  }

  .change-btn {
    padding: 0.375rem 0.625rem;
    font-size: 0.75rem;
  }

  #withdraw-submit {
    padding: 0.75rem;
    font-size: 0.9375rem;
  }

  .withdraw-note {
    font-size: 0.75rem;
    padding: 0.75rem;
  }

  .withdraw-note span {
    display: block;
    margin-top: 0.25rem;
  }
}

@media (max-width: 320px) {
  .dashboard-container {
    padding: 0.25rem;
  }

  .withdraw-container {
    padding: 0.25rem;
    gap: 0.75rem;
  }

  .balance-card {
    padding: 0.75rem;
  }

  .balance-amount {
    font-size: 1.25rem;
  }

  .method-item {
    padding: 0.625rem;
  }

  .amount-input-group {
    padding: 0.5rem;
  }

  .quick-amount-btn {
    padding: 0.375rem;
    font-size: 0.75rem;
  }

.page-title {
    font-size: 1rem;
  }
}

/* Enhanced Balance Card Styles */
.balance-card {
  background: var(--color-bg-card, #333);
  border-radius: 12px;
  padding: 1.5rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.balance-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--primary-color, #2196F3), var(--success-color, #4CAF50));
}

.balance-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  border-color: rgba(33, 150, 243, 0.3);
}

.balance-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.balance-header h3 {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-primary, #fff);
}

.balance-status {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.375rem 0.75rem;
  background: rgba(76, 175, 80, 0.1);
  border-radius: 20px;
  border: 1px solid rgba(76, 175, 80, 0.3);
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--success-color, #4CAF50);
}

.balance-status i {
  font-size: 0.875rem;
}

.balance-amount {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--text-primary, #fff);
  margin-bottom: 1rem;
  font-family: 'Roboto Mono', monospace;
  background: linear-gradient(135deg, var(--text-primary, #fff), var(--primary-color, #2196F3));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.balance-breakdown {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-bottom: 1rem;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.breakdown-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.875rem;
}

.breakdown-item span:first-child {
  color: var(--text-secondary, #ccc);
}

.breakdown-item span:last-child {
  font-weight: 600;
  color: var(--text-primary, #fff);
  font-family: 'Roboto Mono', monospace;
}

/* Enhanced Method Items */
.method-item {
  background: var(--color-bg-card, #333);
  border-radius: 12px;
  padding: 1rem;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border: 1px solid rgba(255, 255, 255, 0.1);
  position: relative;
  overflow: hidden;
}

.method-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: left 0.5s ease;
}

.method-item:hover::before {
  left: 100%;
}

.method-item:hover {
  background: var(--color-bg-hover, #444);
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  border-color: rgba(33, 150, 243, 0.3);
}

.method-item.active {
  background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05));
  border-color: var(--primary-color, #2196F3);
  box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);
}

.method-icon {
  width: 48px;
  height: 48px;
  background: var(--primary-color, #2196F3);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.25rem;
  transition: all 0.3s ease;
}

.method-item:hover .method-icon {
  transform: scale(1.1);
  background: linear-gradient(135deg, var(--primary-color, #2196F3), #1976D2);
}

.method-status.verified {
  color: var(--success-color, #4CAF50);
}

.method-status i {
  margin-right: 0.25rem;
}

/* Enhanced Form Elements */
.amount-input-group {
  background: var(--color-bg-card, #333);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 0.75rem;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.amount-input-group::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
  transition: left 0.5s ease;
}

.amount-input-group:focus-within::before {
  left: 100%;
}

.amount-input-group:focus-within {
  border-color: var(--primary-color, #2196F3);
  box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
  background: rgba(33, 150, 243, 0.05);
}

.currency-symbol {
  color: var(--text-secondary, #ccc);
  font-weight: 600;
  margin-right: 0.5rem;
  font-size: 1.1rem;
}

.amount-input-group input {
  border: none;
  background: transparent;
  color: var(--text-primary, #fff);
  font-size: 1.1rem;
  padding: 0.5rem;
  outline: none;
  font-family: 'Roboto Mono', monospace;
  width: 100%;
}

.amount-input-group input::placeholder {
  color: var(--text-muted, #888);
}

/* Enhanced Quick Amount Buttons */
.quick-amount-btn {
  background: var(--color-bg-card, #333);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 0.75rem;
  cursor: pointer;
  text-align: center;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-weight: 500;
  position: relative;
  overflow: hidden;
}

.quick-amount-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: left 0.5s ease;
}

.quick-amount-btn:hover::before {
  left: 100%;
}

.quick-amount-btn:hover {
  background: var(--primary-color, #2196F3);
  color: white;
  border-color: var(--primary-color, #2196F3);
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
}

.quick-amount-btn.max-btn {
  background: linear-gradient(135deg, var(--success-color, #4CAF50), #388E3C);
  border-color: var(--success-color, #4CAF50);
  font-weight: 600;
}

.quick-amount-btn.max-btn:hover {
  background: linear-gradient(135deg, #388E3C, var(--success-color, #4CAF50));
  box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
}

/* Enhanced Fee Summary */
.fee-summary {
  background: var(--color-bg-card, #333);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 1rem;
  position: relative;
  overflow: hidden;
}

.fee-summary::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--primary-color, #2196F3), var(--success-color, #4CAF50));
}

.fee-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 0;
  font-size: 0.875rem;
}

.fee-item.total {
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  padding-top: 1rem;
  margin-top: 0.5rem;
  font-weight: 600;
  font-size: 1rem;
}

.fee-item span:first-child {
  color: var(--text-secondary, #ccc);
}

.fee-item span:last-child {
  color: var(--text-primary, #fff);
  font-family: 'Roboto Mono', monospace;
}

/* Enhanced Submit Button */
#withdraw-submit {
  background: linear-gradient(135deg, var(--primary-color, #2196F3), #1976D2);
  border: none;
  border-radius: 12px;
  padding: 1rem;
  color: white;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  width: 100%;
}

#withdraw-submit::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

#withdraw-submit:hover::before {
  left: 100%;
}

#withdraw-submit:hover {
  background: linear-gradient(135deg, #1976D2, var(--primary-color, #2196F3));
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
}

#withdraw-submit:active {
  transform: translateY(0);
}

#withdraw-submit:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

/* Enhanced Notes */
.withdraw-note {
  background: rgba(255, 193, 7, 0.1);
  border: 1px solid rgba(255, 193, 7, 0.3);
  border-radius: 12px;
  padding: 1rem;
  font-size: 0.875rem;
  color: #FFD54F;
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
}

.withdraw-note i {
  color: #FFD54F;
  margin-top: 0.125rem;
  font-size: 1rem;
}

.balance-note {
  background: rgba(33, 150, 243, 0.1);
  border: 1px solid rgba(33, 150, 243, 0.3);
  border-radius: 8px;
  padding: 0.75rem;
  font-size: 0.8125rem;
  color: var(--text-secondary, #ccc);
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  margin-top: 1rem;
}

.balance-note i {
  color: var(--primary-color, #2196F3);
  margin-top: 0.125rem;
  font-size: 0.875rem;
}

.amount-note {
  font-size: 0.75rem;
  color: var(--text-muted, #888);
  margin-top: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.amount-note::before {
  content: '💡';
  font-size: 0.875rem;
}

/* Enhanced Account Display */
.account-display {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.account-info {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.account-name {
  font-weight: 600;
  color: var(--text-primary, #fff);
}

.account-number {
  font-size: 0.875rem;
  color: var(--text-secondary, #ccc);
  font-family: 'Roboto Mono', monospace;
}

.change-btn {
  background: transparent;
  border: 1px solid var(--primary-color, #2196F3);
  color: var(--primary-color, #2196F3);
  padding: 0.375rem 0.75rem;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.75rem;
  transition: all 0.3s ease;
}

.change-btn:hover {
  background: var(--primary-color, #2196F3);
  color: white;
}

/* Enhanced Form Labels */
.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: var(--text-primary, #fff);
  font-size: 0.875rem;
}

.form-group {
  margin-bottom: 1rem;
}

/* Enhanced Select Dropdown */
#crypto-type {
  width: 100%;
  padding: 0.75rem;
  background: var(--color-bg-card, #333);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  color: var(--text-primary, #fff);
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

#crypto-type:hover {
  border-color: var(--primary-color, #2196F3);
}

#crypto-type:focus {
  outline: none;
  border-color: var(--primary-color, #2196F3);
  box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
}

#crypto-wallet {
  width: 100%;
  padding: 0.75rem;
  background: var(--color-bg-card, #333);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  color: var(--text-primary, #fff);
  font-size: 0.875rem;
  font-family: 'Roboto Mono', monospace;
  transition: all 0.3s ease;
}

#crypto-wallet:hover {
  border-color: var(--primary-color, #2196F3);
}

#crypto-wallet:focus {
  outline: none;
  border-color: var(--primary-color, #2196F3);
  box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
}

#crypto-wallet::placeholder {
  color: var(--text-muted, #888);
}

/* Bonus Section Styles */
.bonus-section {
  margin: 1rem 0;
}

.bonus-card {
  background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 235, 59, 0.05));
  border: 1px solid rgba(255, 193, 7, 0.3);
  border-radius: 16px;
  padding: 1.5rem;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.bonus-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: left 0.6s ease;
}

.bonus-card:hover::before {
  left: 100%;
}

.bonus-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(255, 193, 7, 0.2);
  border-color: rgba(255, 193, 7, 0.5);
}

.bonus-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.bonus-header i {
  color: #FFD54F;
  font-size: 1.5rem;
  animation: pulse 2s infinite;
}

.bonus-header h4 {
  margin: 0;
  color: #FFD54F;
  font-size: 1.125rem;
  font-weight: 600;
}

@keyframes pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.1);
    opacity: 0.8;
  }
}

.bonus-content {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.bonus-text {
  color: #FFD54F;
  font-size: 0.9375rem;
  margin: 0;
  text-align: center;
  font-weight: 500;
}

.bonus-text strong {
  color: #FFF;
  font-size: 1.125rem;
  font-weight: 700;
}

.bonus-progress {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #FFD54F, #FFC107);
  border-radius: 4px;
  transition: width 0.3s ease;
  position: relative;
}

.progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

.progress-text {
  color: #FFD54F;
  font-size: 0.8125rem;
  text-align: center;
  font-weight: 500;
}

.bonus-rewards {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 0.75rem;
}

.reward-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  border: 1px solid rgba(255, 193, 7, 0.2);
  transition: all 0.3s ease;
}

.reward-item:hover {
  background: rgba(255, 193, 7, 0.1);
  transform: translateY(-2px);
  border-color: rgba(255, 193, 7, 0.4);
}

.reward-item i {
  color: #FFD54F;
  font-size: 1.25rem;
}

.reward-item span {
  color: #FFD54F;
  font-size: 0.75rem;
  font-weight: 500;
  text-align: center;
}

/* Responsive Bonus Section */
@media (max-width: 768px) {
  .bonus-card {
    padding: 1.25rem;
  }

  .bonus-header {
    gap: 0.5rem;
  }

  .bonus-header h4 {
    font-size: 1rem;
  }

  .bonus-text {
    font-size: 0.875rem;
  }

  .bonus-text strong {
    font-size: 1rem;
  }

  .bonus-rewards {
    grid-template-columns: 1fr;
    gap: 0.5rem;
  }

  .reward-item {
    flex-direction: row;
    justify-content: flex-start;
    gap: 0.75rem;
    padding: 0.625rem;
  }

  .reward-item span {
    font-size: 0.8125rem;
  }
}

@media (max-width: 480px) {
  .bonus-card {
    padding: 1rem;
  }

  .bonus-header {
    flex-direction: column;
    text-align: center;
    gap: 0.5rem;
  }

  .bonus-header h4 {
    font-size: 0.9375rem;
  }

  .bonus-text {
    font-size: 0.8125rem;
  }

  .bonus-text strong {
    font-size: 0.9375rem;
  }

  .reward-item {
    padding: 0.5rem;
  }

  .reward-item i {
    font-size: 1rem;
  }

  .reward-item span {
    font-size: 0.75rem;
  }
}

</style>
<body>
    <div class="dashboard-container">
        <!-- Simplified header for withdraw page -->
        <header class="topbar">
            <div class="topbar-left">
                <a href="dashboard.html" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <h1 class="page-title">Withdraw Funds</h1>
            </div>
            
            <div class="topbar-right">
                <button class="theme-toggle" id="theme-toggle">
                    <i class="fas fa-sun"></i>
                </button>
            </div>
        </header>

        <main class="content">
            <div class="withdraw-container">
                <!-- Enhanced Available Balance -->
                <div class="balance-overview">
                    <div class="balance-card">
                        <div class="balance-header">
                            <h3>Available for Withdrawal</h3>
                            <div class="balance-status">
                                <i class="fas fa-shield-alt"></i>
                                <span>Secure</span>
                            </div>
                        </div>
                        <div class="balance-amount" id="available-balance">$15,430.25</div>
                        <div class="balance-breakdown">
                            <div class="breakdown-item">
                                <span>Trading Balance</span>
                                <span>$14,230.25</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Available Now</span>
                                <span>$1,200.00</span>
                            </div>
                        </div>
                        <div class="balance-note">
                            <i class="fas fa-info-circle"></i>
                            <span>Funds from recent trades may take 24-48 hours to become available</span>
                        </div>
                    </div>
                </div>

                <!-- Withdrawal Methods -->
                <div class="withdraw-methods">
                    <h3>Withdrawal Method</h3>
                    <div class="methods-list">
                        <div class="method-item active" data-method="bank">
                            <div class="method-icon">
                                <i class="fas fa-university"></i>
                            </div>
                            <div class="method-info">
                                <h4>Bank Account</h4>
                                <p>****1234 • 1-3 business days</p>
                            </div>
                            <div class="method-status verified">
                                <i class="fas fa-check-circle"></i>
                                <span>Verified</span>
                            </div>
                        </div>
                        
                        <div class="method-item" data-method="paypal">
                            <div class="method-icon">
                                <i class="fab fa-paypal"></i>
                            </div>
                            <div class="method-info">
                                <h4>PayPal</h4>
                                <p>sarah.chen@email.com • Instant</p>
                            </div>
                            <div class="method-status verified">
                                <i class="fas fa-check-circle"></i>
                                <span>Verified</span>
                            </div>
                        </div>
                        
                        <div class="method-item" data-method="crypto">
                            <div class="method-icon">
                                <i class="fab fa-bitcoin"></i>
                            </div>
                            <div class="method-info">
                                <h4>Crypto Wallet</h4>
                                <p>Add new wallet address</p>
                            </div>
                            <div class="method-status">
                                <i class="fas fa-plus"></i>
                                <span>Add</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Withdrawal Form -->
                <div class="withdraw-form-container">
                    <form class="withdraw-form" id="withdraw-form">
                        <div class="form-group">
                            <label for="withdraw-amount">Withdrawal Amount</label>
                            <div class="amount-input-group">
                                <span class="currency-symbol">$</span>
                                <input 
                                    type="number" 
                                    id="withdraw-amount" 
                                    placeholder="0.00" 
                                    min="10" 
                                    step="0.01" 
                                    required
                                >
                            </div>
                            <div class="amount-note">Minimum withdrawal: $10.00</div>
                        </div>

                        <!-- Quick Amount Buttons -->
                        <div class="quick-amounts">
                            <button type="button" class="quick-amount-btn" data-amount="100">$100</button>
                            <button type="button" class="quick-amount-btn" data-amount="500">$500</button>
                            <button type="button" class="quick-amount-btn" data-amount="1000">$1,000</button>
                            <button type="button" class="quick-amount-btn max-btn" data-amount="max">Max</button>
                        </div>

                        <!-- Withdrawal Details -->
                        <div class="withdrawal-details" id="bank-withdrawal" style="display: block;">
                            <div class="detail-group">
                                <label>Bank Account</label>
                                <div class="account-display">
                                    <div class="account-info">
                                        <span class="account-name">Chase Bank</span>
                                        <span class="account-number">****1234</span>
                                    </div>
                                    <button type="button" class="change-btn">Change</button>
                                </div>
                            </div>
                        </div>

                        <div class="withdrawal-details" id="paypal-withdrawal" style="display: none;">
                            <div class="detail-group">
                                <label>PayPal Account</label>
                                <div class="account-display">
                                    <div class="account-info">
                                        <span class="account-name">PayPal</span>
                                        <span class="account-number">sarah.chen@email.com</span>
                                    </div>
                                    <button type="button" class="change-btn">Change</button>
                                </div>
                            </div>
                        </div>

                        <div class="withdrawal-details" id="crypto-withdrawal" style="display: none;">
                            <div class="form-group">
                                <label for="crypto-type">Cryptocurrency</label>
                                <select id="crypto-type">
                                    <option value="BTC">Bitcoin (BTC)</option>
                                    <option value="ETH">Ethereum (ETH)</option>
                                    <option value="USDT">Tether (USDT)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="crypto-wallet">Wallet Address</label>
                                <input type="text" id="crypto-wallet" placeholder="Enter wallet address" required>
                            </div>
                        </div>

                        <!-- Fee Summary -->
                        <div class="fee-summary">
                            <div class="fee-item">
                                <span>Withdrawal Amount</span>
                                <span id="withdraw-fee-amount">$0.00</span>
                            </div>
                            <div class="fee-item">
                                <span>Processing Fee</span>
                                <span id="withdraw-fee-processing">$2.50</span>
                            </div>
                            <div class="fee-item total">
                                <span>You'll Receive</span>
                                <span id="withdraw-fee-total">$0.00</span>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-large" id="withdraw-submit">
                            <i class="fas fa-minus"></i>
                            Submit Withdrawal
                        </button>

                        <!-- Bonus Information -->
                        <div class="bonus-section">
                            <div class="bonus-card">
                                <div class="bonus-header">
                                    <i class="fas fa-gift"></i>
                                    <h4>Withdrawal Bonus Available!</h4>
                                </div>
                                <div class="bonus-content">
                                    <p class="bonus-text">Get <strong>2% bonus</strong> on withdrawals over $500!</p>
                                    <div class="bonus-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 85%"></div>
                                        </div>
                                        <span class="progress-text">$425 / $500 to unlock bonus</span>
                                    </div>
                                    <div class="bonus-rewards">
                                        <div class="reward-item">
                                            <i class="fas fa-star"></i>
                                            <span>Priority Processing</span>
                                        </div>
                                        <div class="reward-item">
                                            <i class="fas fa-shield-alt"></i>
                                            <span>Enhanced Security</span>
                                        </div>
                                        <div class="reward-item">
                                            <i class="fas fa-chart-line"></i>
                                            <span>Trading Insights</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="withdraw-note">
                            <i class="fas fa-clock"></i>
                            <span>Withdrawals are processed within 1-3 business days</span>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <button class="nav-item" data-page="home">
        <i class="fas fa-home"></i>
        <span>Home</span>
      </button>
      <button class="nav-item" data-page="trading">
        <i class="fas fa-chart-line"></i>
        <span>Trading</span>
      </button>
      <button class="nav-item" data-page="transactions">
        <i class="fas fa-exchange-alt"></i>
        <span>Transactions</span>
      </button>
      <button class="nav-item" data-page="notifications">
        <i class="fas fa-bell"></i>
        <span>Notifications</span>
      </button>
      <button class="nav-item" data-page="support">
        <i class="fas fa-headset"></i>
        <span>Support</span>
      </button>
    </nav>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module">
        import { authManager } from './js/auth.js';
        import { apiClient } from './js/api.js';
        import { formatCurrency, showToast, showLoading } from './js/utils.js';
        
        document.addEventListener('DOMContentLoaded', () => {
            initWithdrawPage();
            initializePageNavigation();
        });

        async function initWithdrawPage() {
            // Check authentication
            if (!authManager.isAuthenticated()) {
                window.location.href = 'login.html';
                return;
            }

            const profile = authManager.getProfile();
            
            if (profile) {
                updateBalanceDisplay(profile);
            }

            setupWithdrawForm();
        }

        function updateBalanceDisplay(profile) {
            const availableBalanceEl = document.getElementById('available-balance');
            const balances = profile.balances || { USD: 0, BTC: 0, ETH: 0 };
            
            if (availableBalanceEl) {
                availableBalanceEl.textContent = formatCurrency(balances.USD);
            }
        }

        function setupWithdrawForm() {
            const form = document.getElementById('withdraw-form');
            const amountInput = document.getElementById('withdraw-amount');
            const methodItems = document.querySelectorAll('.method-item');
            const quickAmountBtns = document.querySelectorAll('.quick-amount-btn');
            
            let selectedMethod = 'bank';

            // Method selection
            methodItems.forEach(item => {
                item.addEventListener('click', () => {
                    if (item.classList.contains('method-item')) {
                        selectedMethod = item.getAttribute('data-method');
                        
                        // Update active state
                        methodItems.forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        
                        // Show/hide withdrawal details
                        document.querySelectorAll('.withdrawal-details').forEach(detail => {
                            detail.style.display = 'none';
                        });
                        
                        const detailsEl = document.getElementById(`${selectedMethod}-withdrawal`);
                        if (detailsEl) {
                            detailsEl.style.display = 'block';
                        }
                        
                        updateFeeSummary();
                    }
                });
            });

            // Quick amount buttons
            quickAmountBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const amount = btn.getAttribute('data-amount');
                    
                    if (amount === 'max') {
                        const profile = authManager.getProfile();
                        const balances = profile.balances || { USD: 0 };
                        const maxAmount = Math.max(0, balances.USD - 2.50); // Subtract fee
                        amountInput.value = maxAmount.toFixed(2);
                    } else {
                        amountInput.value = amount;
                    }
                    
                    updateFeeSummary();
                    
                    // Visual feedback
                    btn.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        btn.style.transform = '';
                    }, 150);
                });
            });

            // Amount input
            amountInput.addEventListener('input', updateFeeSummary);

            // Form submission
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                await processWithdrawal(selectedMethod);
            });

            function updateFeeSummary() {
                const amount = parseFloat(amountInput.value) || 0;
                const fee = 2.50; // Fixed withdrawal fee
                const total = Math.max(0, amount - fee);
                
                document.getElementById('withdraw-fee-amount').textContent = formatCurrency(amount);
                document.getElementById('withdraw-fee-processing').textContent = formatCurrency(fee);
                document.getElementById('withdraw-fee-total').textContent = formatCurrency(total);
            }

            async function processWithdrawal(method) {
                const amount = parseFloat(amountInput.value);
                const profile = authManager.getProfile();
                const balances = profile.balances || { USD: 0 };
                
                if (!amount || amount < 10) {
                    showToast('Minimum withdrawal amount is $10.00', 'error');
                    return;
                }

                if (amount > balances.USD) {
                    showToast('Insufficient balance', 'error');
                    return;
                }

                const submitBtn = document.getElementById('withdraw-submit');
                
                try {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                    showLoading(true);

                    // Create withdrawal request
                    const withdrawal = {
                        user_id: authManager.getUser().id,
                        amount: amount,
                        currency: 'USD',
                        method: method,
                        address_or_account: method === 'bank' ? '****1234' : 
                                          method === 'paypal' ? profile.email : 
                                          document.getElementById('crypto-wallet')?.value || '',
                        status: 'pending'
                    };
                    
                    const { data, error } = await apiClient.createWithdrawal(withdrawal);
                    
                    if (error) {
                        throw new Error(error.message);
                    }
                    
                    // Create transaction
                    await apiClient.createTransaction({
                        user_id: authManager.getUser().id,
                        type: 'withdrawal',
                        amount: amount,
                        currency: 'USD',
                        status: 'pending',
                        note: `Withdrawal request via ${method}`,
                        metadata: { withdrawal_id: data.id, method }
                    });
                    
                    // Update user balance (deduct immediately)
                    const newBalances = { ...balances, USD: balances.USD - amount };
                    await apiClient.updateUser(authManager.getUser().id, {
                        balances: newBalances
                    });
                    
                    // Add notification
                    await apiClient.createNotification({
                        user_id: authManager.getUser().id,
                        title: 'Withdrawal Request Submitted',
                        body: `Your withdrawal request for ${formatCurrency(amount)} has been submitted and is being processed.`,
                        type: 'withdrawal',
                        read: false
                    });

                    showToast(`Withdrawal request of ${formatCurrency(amount)} submitted successfully!`, 'success');
                    
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 1500);

                } catch (error) {
                    console.error('Withdrawal error:', error);
                    showToast('Withdrawal request failed. Please try again.', 'error');
                } finally {
                    showLoading(false);
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-minus"></i> Submit Withdrawal';
                }
            }
        }

        // Bottom Navigation Functionality
        function initializePageNavigation() {
          const navItems = document.querySelectorAll(".bottom-nav .nav-item");

          function showPage(pageName) {
            // Update active states
            navItems.forEach((btn) => btn.classList.remove("active"));
            const activeBtn = document.querySelector(
              `.bottom-nav .nav-item[data-page="${pageName}"]`
            );
            if (activeBtn) activeBtn.classList.add("active");

            // Navigate to the page
            switch(pageName) {
              case 'home':
                window.location.href = './dashboard.html';
                break;
              case 'trading':
                window.location.href = './trading.html';
                break;
              case 'transactions':
                window.location.href = './transfer.html';
                break;
              case 'notifications':
                window.location.href = './settings.html';
                break;
              case 'support':
                window.location.href = './customer-support.html';
                break;
            }
          }

          navItems.forEach((btn) => {
            btn.addEventListener("click", () => {
              const pageName = btn.getAttribute("data-page");
              showPage(pageName);
            });
          });
        }
    </script>
</body>
</html>
